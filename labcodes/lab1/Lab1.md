# 操作系统的中断



## 基础

### 概念
* CPU 收到中断指令后保存当前状态，开始处理其他事情。

### 功能
1. 增加CPU效率
2. 防止程序无限运行

### 进行中断处理支持的方法
* 编写相应的中断处理代码
* 在启动中正确设置控制寄存器
* CPU捕获异常
* 控制转交给相应中断处理代码进行处理
* 返回正在运行的程序



## 分类
1. 异常(Exception)：在执行一条指令的过程中发生了错误，此时通过中断来处理错误
2. 陷入(Trap)：主动通过一条指令停下来，并跳转到处理函数
3. 外部中断(Interrupt)： CPU 的执行过程被外设发来的信
号打断，此时必须先停下来对该外设进行处理



## riscv64 权限模式
1. M mode（机器模式）
    * 最高权限模式
    * 运行的 hart 对内存,I/O和一些对于启动和配置系统来说必要的底层功能有着完全的使用权
    * 发生异常控制权都会被移交到 M 模式的异常处理程序
    * 唯一所有标准 RISC-V 处理器都必须实现的权限模式

2. S mode（监督则模式）
    * 支持现代类 Unix 操作系统的权限模式
    * 核心：支持基于页面的虚拟内存机制

3. 